## راهنمای جامع دستور `git reset`

دستور `git reset` یکی از مهم‌ترین و قدرتمندترین دستورات در گیت است که برای بازگرداندن مخزن به وضعیت قبلی استفاده می‌شود. این دستور به شما امکان می‌دهد تا تغییرات انجام‌شده در کامیت‌ها، مرحله آماده‌سازی (staging area)، و دایرکتوری کاری (working directory) را به حالت قبل برگردانید. در این مستند، نحوه کار با `git reset`، انواع آن و تفاوت‌های کلیدی آن با دستورات مشابه مانند `git checkout` و `git restore` توضیح داده خواهد شد.

### دستور `git reset` چه کاری انجام می‌دهد؟

دستور `git reset` به طور کلی برای سه هدف اصلی استفاده می‌شود:

1. **بازگرداندن HEAD به کامیتی خاص:** با استفاده از این دستور می‌توانید HEAD و شاخه‌ای که روی آن کار می‌کنید را به یک کامیت مشخص بازگردانید.
2. **حذف تغییرات از مرحله آماده‌سازی:** این دستور می‌تواند فایل‌هایی که به مرحله آماده‌سازی (staging area) اضافه شده‌اند را از آن خارج کند، بدون آنکه تغییری در محتوای دایرکتوری کاری شما ایجاد شود.
3. **بازگرداندن تغییرات در دایرکتوری کاری:** می‌تواند تغییرات فایل‌ها را در دایرکتوری کاری شما به حالت قبل از آخرین کامیت برگرداند.

#### سینتکس:

```bash
git reset [<mode>] [<commit>]
```

- **`<mode>`**: حالت یا نوع بازگردانی که می‌تواند یکی از سه حالت `--soft`، `--mixed` یا `--hard` باشد.
- **`<commit>`**: کامیت مشخصی که می‌خواهید HEAD و شاخه فعلی خود را به آن بازگردانید.

### انواع `git reset`

دستور `git reset` دارای سه حالت اصلی است که هر کدام تأثیر متفاوتی روی مخزن شما دارند:

#### 1. **حالت `--soft`**

در این حالت، HEAD به کامیت مشخص‌شده بازگردانده می‌شود، اما تغییرات انجام‌شده در مرحله آماده‌سازی (staging area) باقی می‌مانند و دایرکتوری کاری بدون تغییر باقی می‌ماند.

```bash
git reset --soft <commit>
```

**چه زمانی استفاده می‌شود؟**
این حالت زمانی مفید است که شما می‌خواهید چندین کامیت اخیر را به یک کامیت ترکیب کنید و نمی‌خواهید تغییرات خود را از دست بدهید. در این حالت، تغییرات به مرحله آماده‌سازی برمی‌گردند و می‌توانید آن‌ها را به کامیت جدید اضافه کنید.

#### 2. **حالت `--mixed`** (حالت پیش‌فرض)

در این حالت، HEAD به کامیت مشخص‌شده بازمی‌گردد و تغییرات از مرحله آماده‌سازی خارج می‌شوند، اما دایرکتوری کاری دست‌نخورده باقی می‌ماند. این حالت پیش‌فرض `git reset` است، یعنی اگر هیچ حالتی مشخص نکنید، از این حالت استفاده می‌شود.

```bash
git reset --mixed <commit>
```

**چه زمانی استفاده می‌شود؟**
این حالت زمانی مناسب است که می‌خواهید تغییرات انجام‌شده را از مرحله آماده‌سازی خارج کنید، اما تغییرات محلی خود را نگه دارید تا بتوانید آن‌ها را دوباره به روش دیگری مرحله‌بندی کنید یا تغییرات بیشتری اعمال کنید.

#### 3. **حالت `--hard`**

در این حالت، HEAD به کامیت مشخص‌شده بازمی‌گردد و تمام تغییرات در مرحله آماده‌سازی و دایرکتوری کاری حذف می‌شوند. این حالت تمام تغییرات محلی و آماده‌سازی شده را به حالت کامیت بازمی‌گرداند.

```bash
git reset --hard <commit>
```

**چه زمانی استفاده می‌شود؟**
از این حالت باید با احتیاط استفاده کرد، زیرا تمام تغییرات محلی که هنوز کامیت نشده‌اند از بین می‌روند. زمانی استفاده می‌شود که مطمئن هستید تغییرات نیازی به حفظ ندارند و می‌خواهید مخزن خود را به طور کامل به یک وضعیت خاص بازگردانید.

### تفاوت `git reset` با `git checkout` و `git restore`

- **`git reset`:** تمرکز این دستور بیشتر بر روی شاخه‌ها و بازگرداندن HEAD به یک کامیت خاص است. همچنین می‌تواند تغییرات مرحله‌بندی شده یا نشده را به طور کامل بازگرداند.
- **`git checkout`:** بیشتر برای تغییر شاخه‌ها یا رفتن به یک کامیت خاص استفاده می‌شود، اما تغییرات در مرحله آماده‌سازی یا دایرکتوری کاری را دست‌نخورده نگه می‌دارد.
- **`git restore`:** این دستور عمدتاً برای بازگرداندن فایل‌ها به وضعیت قبلی‌شان استفاده می‌شود، بدون آنکه شاخه یا HEAD تغییر کند. `git restore` برای مدیریت دقیق‌تر فایل‌ها کاربرد دارد.

### چه اتفاقی در پس‌زمینه دستور `git reset` می‌افتد؟

دستور `git reset` اساساً بر سه ناحیه اصلی در گیت تأثیر می‌گذارد: HEAD، مرحله آماده‌سازی (staging area)، و دایرکتوری کاری (working directory). بسته به حالت استفاده‌شده، دستور `git reset` تغییراتی در این نواحی ایجاد می‌کند.

#### 1. **HEAD:**

- **زمانی که `git reset` اجرا می‌شود، HEAD به کامیت مشخص‌شده بازمی‌گردد.** این یعنی گیت به شما نشان می‌دهد که اکنون در کدام کامیت قرار دارید. HEAD همیشه به آخرین کامیتی که در شاخه فعلی انجام شده اشاره می‌کند. وقتی شما از `git reset` استفاده می‌کنید، این اشاره‌گر به کامیت جدیدی تغییر می‌کند.

#### 2. **مرحله آماده‌سازی (Index):**

- **در حالت `--soft`، مرحله آماده‌سازی بدون تغییر باقی می‌ماند.**
- **در حالت `--mixed`، مرحله آماده‌سازی به وضعیت کامیت مشخص‌شده بازمی‌گردد و تغییرات از مرحله آماده‌سازی حذف می‌شوند.**
- **در حالت `--hard`، تمام تغییرات از مرحله آماده‌سازی حذف می‌شوند و به طور کامل به حالت کامیت بازمی‌گردند.**

#### 3. **دایرکتوری کاری (Working Directory):**

- **در حالت `--soft` و `--mixed`، دایرکتوری کاری شما بدون تغییر باقی می‌ماند.** تغییرات شما همچنان در فایل‌های محلی شما وجود دارند، اما این تغییرات ممکن است دیگر آماده برای کامیت نباشند.
- **در حالت `--hard`، دایرکتوری کاری نیز بازنشانی می‌شود و هر تغییری که بعد از کامیت مشخص‌شده ایجاد شده بود، حذف می‌شود.** این یعنی تمام تغییرات محلی که هنوز کامیت نشده‌اند از دست می‌روند.

#### فایل‌های مرجع:

در پس‌زمینه، گیت با استفاده از فایل‌های مرجع (references) مانند `HEAD` و `refs/heads/main` عمل می‌کند تا شاخه‌ها و کامیت‌های جاری را پیگیری کند. وقتی شما از `git reset` استفاده می‌کنید، این فایل‌های مرجع به روز می‌شوند تا نشان دهند که HEAD به کدام کامیت جدید اشاره دارد.

### نکات و ترفندها

#### 1. **استفاده از `git reset --soft` برای اصلاح چندین کامیت:**

اگر چندین کامیت انجام داده‌اید و می‌خواهید آن‌ها را به یک کامیت ترکیب کنید، می‌توانید از حالت `--soft` استفاده کنید تا تغییرات را به مرحله آماده‌سازی بازگردانید و سپس همه آن‌ها را در یک کامیت جدید ذخیره کنید.

```bash
git reset --soft HEAD~3
git commit -m "Combine three commits into one"
```

#### 2. **استفاده از `git reset --hard` با احتیاط:**

از حالت `--hard` با دقت استفاده کنید، زیرا تمام تغییرات محلی و آماده‌سازی‌شده حذف خواهند شد و نمی‌توان آن‌ها را به راحتی بازگرداند. اگر می‌خواهید تغییرات محلی خود را حفظ کنید، قبل از اجرای این دستور از آن‌ها نسخه پشتیبان تهیه کنید یا از دستور `git stash` برای ذخیره موقت تغییرات استفاده کنید.

#### 3. **استفاده از `git reset` برای تغییرات جزئی:**

اگر فقط می‌خواهید یک فایل خاص را از مرحله آماده‌سازی خارج کنید، می‌توانید به جای بازگرداندن کل شاخه، از دستور زیر استفاده کنید:

```bash
git reset <filename>
```

این دستور فایل مشخص‌شده را از مرحله آماده‌سازی خارج می‌کند، اما تغییرات محلی آن باقی می‌مانند.

#### 4. **بازگردانی به کامیت قبلی بدون حذف تغییرات محلی:**

اگر می‌خواهید به یک کامیت قبلی برگردید اما تغییرات محلی خود را نگه دارید، می‌توانید از حالت `--mixed` استفاده کنید. این کار شاخه شما را به وضعیت قبلی بازمی‌گرداند، اما تغییرات همچنان در دایرکتوری کاری شما وجود خواهند داشت.

### نتیجه‌گیری

دستور `git reset` یکی از ابزارهای قدرتمند و

انعطاف‌پذیر گیت است که به شما اجازه می‌دهد تغییرات را به راحتی مدیریت کنید، شاخه‌های خود را به عقب برگردانید، و تغییرات مرحله‌بندی‌شده یا نشده را به حالت قبلی بازگردانید. با درک درست از نحوه عملکرد هر حالت (soft، mixed، hard)، می‌توانید از این دستور به شکل مؤثری در پروژه‌های خود استفاده کنید و از هرگونه اشتباه در مدیریت تغییرات جلوگیری کنید.

در ادامه به برسی تفاوت میان `restore` و `reset` می‌پردازیم
