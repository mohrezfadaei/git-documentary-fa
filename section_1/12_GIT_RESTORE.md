## راهنمای جامع دستور `git restore`

دستور `git restore` یکی از دستورات جدیدتر در گیت است که برای بازگرداندن فایل‌ها به وضعیت قبلی استفاده می‌شود. این دستور می‌تواند تغییراتی که در فایل‌های کاری ایجاد شده‌اند را به حالت قبلی برگرداند یا فایل‌هایی را که به مرحله آماده‌سازی (staging area) اضافه شده‌اند، از آن حذف کند.

### دستور `git restore` چه کاری انجام می‌دهد؟

دستور `git restore` به شما اجازه می‌دهد تا تغییراتی را که در فایل‌های کاری انجام داده‌اید یا تغییراتی که در مرحله آماده‌سازی قرار گرفته‌اند، بازگردانید. این دستور جایگزینی برای برخی از قابلیت‌های قدیمی‌تر مانند `git checkout` برای بازگرداندن فایل‌ها است و به شکلی واضح‌تر و متمرکزتر این وظایف را انجام می‌دهد.

#### سینتکس:

```bash
git restore [options] <path>
```

در این دستور، `<path>` مسیری به فایل یا دایرکتوری‌ای است که قصد بازگرداندن آن را دارید.

#### نمونه‌های استفاده:

1. **بازگرداندن تغییرات فایل از مرحله آماده‌سازی:**

   اگر فایل‌هایی را به اشتباه به مرحله آماده‌سازی (staging area) اضافه کرده‌اید و می‌خواهید آن‌ها را به وضعیت قبل از آماده‌سازی برگردانید:

   ```bash
   git restore --staged <filename>
   ```

   این دستور فایل مورد نظر را از مرحله آماده‌سازی خارج می‌کند و به وضعیت نادیده گرفته شده (unstaged) برمی‌گرداند.

2. **بازگرداندن تغییرات فایل به حالت آخرین کامیت:**

   اگر فایل‌هایی را در دایرکتوری کاری خود تغییر داده‌اید و می‌خواهید تغییرات آن‌ها را به آخرین نسخه کامیت‌شده بازگردانید:

   ```bash
   git restore <filename>
   ```

   این دستور تغییرات انجام‌شده روی فایل را بازگردانده و فایل را به وضعیت آخرین کامیت موجود برمی‌گرداند.

#### گزینه‌های پرکاربرد با `git restore`

#### 1. **بازگرداندن از مرحله آماده‌سازی با `--staged`:**

با استفاده از این گزینه، فایل‌ها یا تغییرات موجود در مرحله آماده‌سازی را به وضعیت قبل از `git add` برمی‌گردانید.

```bash
git restore --staged <filename>
```

#### 2. **بازگرداندن فایل‌های کاری با `--source`:**

می‌توانید از این گزینه برای مشخص کردن منبعی که فایل‌ها باید از آن بازگردانده شوند استفاده کنید. به طور پیش‌فرض، این منبع HEAD (آخرین کامیت) است.

```bash
git restore --source=<commit> <filename>
```

#### 3. **استفاده از `--worktree` برای بازگرداندن به حالت کامیت:**

برای بازگرداندن تغییرات یک فایل خاص به وضعیت آخرین کامیت در دایرکتوری کاری، از این گزینه استفاده می‌شود.

```bash
git restore --worktree <filename>
```

#### 4. **بازگرداندن همه فایل‌ها:**

اگر می‌خواهید همه فایل‌های موجود در پروژه را به وضعیت آخرین کامیت برگردانید:

```bash
git restore .
```

### تفاوت `git restore` و `git checkout`

پیش از معرفی دستور `git restore`، از `git checkout` برای بازگرداندن تغییرات فایل‌ها استفاده می‌شد. اما `git restore` به طور خاص برای این کار طراحی شده و تفاوت‌های کلیدی با `git checkout` دارد:

- **`git checkout` برای مدیریت شاخه‌ها و بازگرداندن فایل‌ها استفاده می‌شد، اما `git restore` صرفاً برای بازگرداندن فایل‌ها از کامیت‌ها و مرحله آماده‌سازی طراحی شده است.**
- **`git restore` دستوری دقیق‌تر و واضح‌تر برای مدیریت بازگردانی فایل‌ها است.**

### چه اتفاقی در پس‌زمینه دستور `git restore` می‌افتد؟

وقتی دستور `git restore` اجرا می‌شود، گیت فایل‌ها را به حالت مشخص‌شده برمی‌گرداند. این دستور به دو حالت کلی می‌تواند عمل کند: بازگرداندن فایل‌ها از مرحله آماده‌سازی یا بازگرداندن فایل‌ها به حالت آخرین کامیت.

1. **بازگرداندن از مرحله آماده‌سازی (Staged Changes):**

   زمانی که از `git restore --staged` استفاده می‌کنید، گیت فایل‌هایی را که به مرحله آماده‌سازی اضافه کرده‌اید از آنجا خارج می‌کند. در این حالت، تغییرات فایل‌ها همچنان در دایرکتوری کاری شما وجود دارند، اما به مرحله آماده‌سازی بازنمی‌گردند و برای کامیت آماده نخواهند بود.

2. **بازگرداندن به وضعیت آخرین کامیت:**

   اگر فایل‌هایی در دایرکتوری کاری تغییر کرده باشند و از دستور `git restore <filename>` استفاده کنید، گیت این تغییرات را لغو می‌کند و فایل‌ها را به وضعیت آخرین کامیتی که در HEAD ثبت شده است، برمی‌گرداند. این به معنای این است که تمام تغییرات محلی روی فایل از بین می‌رود و فایل به وضعیت دقیق کامیت بازگردانده می‌شود.

#### فایل‌های موقت گیت:

در پس‌زمینه، گیت از یک پایگاه داده داخلی شامل تمام کامیت‌ها و تغییرات (در پوشه‌ی مخفی `.git/objects/`) استفاده می‌کند. هر زمان که شما یک فایل را بازگردانید، گیت از اطلاعات ذخیره‌شده در این پایگاه داده استفاده می‌کند تا فایل را به وضعیت قبلی‌اش برگرداند.

### نکات و ترفندها

#### 1. **استفاده از `git restore` با احتیاط:**

دستور `git restore` می‌تواند تغییرات محلی شما را حذف کند. اگر مطمئن نیستید که می‌خواهید تغییرات را از دست بدهید، بهتر است ابتدا با استفاده از دستور `git status` بررسی کنید که چه فایل‌هایی تغییر کرده‌اند و آیا نیاز به بازگردانی آن‌ها دارید یا خیر.

#### 2. **بازگردانی فقط بخشی از تغییرات:**

اگر بخواهید تنها بخشی از تغییرات یک فایل را بازگردانید، می‌توانید از ابزارهایی مانند `git add -p` استفاده کنید که به شما امکان می‌دهد تکه‌های خاصی از تغییرات را مرحله‌بندی یا بازگردانی کنید.

#### 3. **ذخیره تغییرات با `git stash`:**

اگر نمی‌خواهید تغییرات فعلی‌تان از بین برود اما هنوز آن‌ها را کامیت نکرده‌اید، می‌توانید تغییرات را با دستور `git stash` ذخیره کنید. سپس می‌توانید فایل‌ها را بازگردانید و بعداً تغییرات ذخیره‌شده را دوباره اعمال کنید.

```bash
git stash
git restore <filename>
git stash pop
```

#### 4. **بازگرداندن تغییرات در شاخه‌های مختلف:**

اگر در شاخه‌ای کار می‌کنید و می‌خواهید تغییرات فایل‌ها را به شاخه دیگری بازگردانید، می‌توانید ابتدا به آن شاخه بروید و سپس از دستور `git restore` استفاده کنید.

### نتیجه‌گیری

دستور `git restore` ابزاری قدرتمند و دقیق برای مدیریت و بازگردانی تغییرات فایل‌ها در گیت است. با استفاده از این دستور، می‌توانید به سرعت تغییرات ناخواسته را لغو کنید و فایل‌های خود را به وضعیت قبلی بازگردانید، چه در مرحله آماده‌سازی و چه در دایرکتوری کاری. همچنین، با درک بهتر از اینکه چه اتفاقی در پس‌زمینه این دستور می‌افتد، می‌توانید مطمئن شوید که تغییرات مهم شما از بین نمی‌رود و پروژه‌های خود را بهتر مدیریت کنید.
