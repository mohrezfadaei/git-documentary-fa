## راهنمای جامع دستور `git diff`

دستور `git diff` یکی از مهم‌ترین و پرکاربردترین دستورات گیت است که به شما امکان می‌دهد تفاوت‌ها و تغییرات ایجادشده بین فایل‌ها، شاخه‌ها، کامیت‌ها و مراحل مختلف (working directory، staging area و repository) را مقایسه و مشاهده کنید. این دستور برای بررسی تغییرات قبل از کامیت و اطمینان از آنچه که قرار است به تاریخچه پروژه اضافه شود، بسیار مفید است.

### دستور `git diff` چه کاری انجام می‌دهد؟

دستور `git diff` تغییرات ایجادشده در فایل‌ها را بین مراحل مختلف بررسی می‌کند و این تغییرات را به شما نمایش می‌دهد. این دستور بسته به اینکه چه چیزی را می‌خواهید مقایسه کنید، انواع مختلفی دارد:

- مقایسه تغییرات فایل‌های دایرکتوری کاری (working directory) با مرحله آماده‌سازی (staging area).
- مقایسه تغییرات بین دو شاخه (branch) مختلف.
- مقایسه تغییرات بین دو کامیت مختلف.

#### سینتکس کلی:

```bash
git diff [options] [<commit1> <commit2> | <path>]
```

- **بدون پارامتر:** تفاوت‌های بین دایرکتوری کاری و ناحیه آماده‌سازی را نشان می‌دهد.
- **با پارامتر `<commit1>` و `<commit2>`:** تفاوت‌های بین دو کامیت را مقایسه می‌کند.
- **با پارامتر `<path>`:** تفاوت‌های یک فایل یا مسیر خاص را نشان می‌دهد.

#### نمونه خروجی:

```plaintext
diff --git a/file1.txt b/file1.txt
index e69de29..d95f3ad 100644
--- a/file1.txt
+++ b/file1.txt
@@ -1,3 +1,4 @@
+Hello World
 Line 1
 Line 2
 Line 3
```

در این نمونه، تغییراتی که در فایل `file1.txt` ایجاد شده است نمایش داده می‌شود. خط‌هایی که با `+` شروع می‌شوند، نشان‌دهنده خط‌هایی هستند که اضافه شده‌اند و خط‌هایی که با `-` شروع می‌شوند، نشان‌دهنده خط‌هایی هستند که حذف شده‌اند.

### گزینه‌های پرکاربرد با `git diff`

#### 1. **نمایش تفاوت بین دایرکتوری کاری و ناحیه آماده‌سازی**

اگر می‌خواهید تفاوت‌های فایل‌های تغییر یافته در دایرکتوری کاری (ولی هنوز به ناحیه آماده‌سازی اضافه نشده‌اند) را ببینید، می‌توانید از دستور ساده زیر استفاده کنید:

```bash
git diff
```

این دستور به شما تغییرات فایل‌های ویرایش‌شده را نسبت به آخرین وضعیت کامیت‌شده نشان می‌دهد.

#### 2. **نمایش تفاوت بین ناحیه آماده‌سازی و کامیت‌ها**

برای مشاهده تغییرات فایل‌هایی که به ناحیه آماده‌سازی اضافه شده‌اند و قرار است در کامیت بعدی ثبت شوند:

```bash
git diff --staged
```

این دستور تفاوت‌های بین فایل‌های مرحله‌بندی شده (staged) و آخرین نسخه کامیت‌شده را نمایش می‌دهد.

#### 3. **مقایسه دو کامیت**

اگر می‌خواهید تغییرات بین دو کامیت را مقایسه کنید:

```bash
git diff <commit1> <commit2>
```

این دستور تفاوت‌های فایل‌ها بین دو کامیت مشخص‌شده را نمایش می‌دهد.

مثال:

```bash
git diff HEAD~1 HEAD
```

این دستور تفاوت‌های بین کامیت فعلی (HEAD) و یک کامیت قبل از آن (HEAD~1) را نمایش می‌دهد.

#### 4. **مقایسه تغییرات یک فایل خاص**

برای مشاهده تفاوت‌های یک فایل خاص:

```bash
git diff <filename>
```

این دستور تفاوت‌های ایجاد شده در یک فایل خاص را نسبت به آخرین وضعیت آماده‌سازی نشان می‌دهد.

#### 5. **نمایش تغییرات بین دو شاخه**

برای مقایسه تغییرات بین دو شاخه (branch) مختلف:

```bash
git diff <branch1> <branch2>
```

این دستور تفاوت‌های بین دو شاخه را نمایش می‌دهد.

مثال:

```bash
git diff main feature
```

این دستور تفاوت‌های شاخه `feature` نسبت به شاخه `main` را نشان می‌دهد.

#### 6. **نمایش تغییرات در حالت خلاصه (Summary)**

اگر به جای جزئیات تغییرات فقط به یک خلاصه از تغییرات نیاز دارید، می‌توانید از گزینه `--stat` استفاده کنید:

```bash
git diff --stat
```

خروجی این دستور تعداد تغییرات فایل‌ها و تعداد خطوط اضافه یا حذف‌شده را به‌طور خلاصه نمایش می‌دهد.

#### 7. **مقایسه تغییرات با آخرین کامیت (HEAD)**

برای مقایسه فایل‌های دایرکتوری کاری با آخرین کامیت (HEAD):

```bash
git diff HEAD
```

این دستور تفاوت‌های فایل‌های تغییر یافته در دایرکتوری کاری را نسبت به آخرین کامیت (HEAD) نشان می‌دهد.

### چه اتفاقی در پس‌زمینه دستور `git diff` می‌افتد؟

وقتی دستور `git diff` اجرا می‌شود، گیت با استفاده از پایگاه داده داخلی خود، که شامل تمام کامیت‌ها و تغییرات فایل‌ها است، تفاوت‌ها را پیدا کرده و آن‌ها را به صورت خطوط اضافه یا حذف‌شده نمایش می‌دهد.

#### نحوه کار `git diff`:

1. **اسکن ناحیه کاری و ناحیه آماده‌سازی:**

   - گیت ابتدا فایل‌های موجود در دایرکتوری کاری (working directory) و ناحیه آماده‌سازی (staging area) را بررسی می‌کند. اگر شما تغییراتی در فایل‌های خود ایجاد کرده‌اید و آن‌ها را هنوز به ناحیه آماده‌سازی اضافه نکرده‌اید، گیت تغییرات این فایل‌ها را با آخرین نسخه‌ای که در مخزن (repository) ذخیره شده است، مقایسه می‌کند.

2. **بررسی کامیت‌ها:**

   - اگر شما از دستور `git diff` برای مقایسه دو کامیت استفاده کنید، گیت این دو کامیت را از پایگاه داده خود می‌خواند و تغییرات بین آن‌ها را محاسبه می‌کند. هر کامیت شامل یک اسنپ‌شات از کل فایل‌های پروژه است و گیت با مقایسه این اسنپ‌شات‌ها تفاوت‌ها را شناسایی می‌کند.

3. **محاسبه تفاوت‌ها:**
   - گیت با استفاده از الگوریتم‌های مختلف مقایسه (diff algorithms)، تفاوت‌های بین نسخه‌های مختلف فایل‌ها را محاسبه می‌کند و تغییرات اضافه یا حذف‌شده را شناسایی می‌کند. سپس این تغییرات را به صورت `+` برای خطوط اضافه‌شده و `-` برای خطوط حذف‌شده نمایش می‌دهد.

#### فایل‌های موقت گیت:

گیت از فایل‌های موقت در پوشه `.git/` استفاده می‌کند تا نسخه‌های مختلف فایل‌ها را ذخیره کند و بتواند آن‌ها را با هم مقایسه کند. هر تغییر، کامیت یا فایل جدیدی که به مخزن اضافه می‌شود، در این پوشه ذخیره می‌شود تا گیت بتواند در هر لحظه تفاوت‌ها را محاسبه کند.

### نکات و ترفندها

#### 1. **استفاده از `git diff --staged` قبل از کامیت**

همیشه قبل از اینکه کامیتی انجام دهید، بهتر است از `git diff --staged` استفاده کنید تا مطمئن شوید که تمام تغییراتی که قرار است کامیت شوند، به درستی مرحله‌بندی شده‌اند و هیچ تغییری از دست نرفته است.

#### 2. **مقایسه تغییرات بین شاخه‌ها قبل از ادغام (Merge)**

قبل از انجام ادغام (merge) بین دو شاخه، از `git diff <branch1> <branch2>` استفاده کنید تا مطمئن شوید که چه تغییراتی قرار است با شاخه دیگر ادغام شوند. این کار از بروز مشکلات ادغام (conflicts) جلوگیری می‌کند.

#### 3. **نمایش تغییرات با رنگ‌بندی**

به طور پیش‌فرض، گیت تفاوت‌ها را با رنگ‌بندی نمایش می‌دهد تا اضافه شدن و حذف خطوط به وضوح مشخص شود. این قابلیت به شما کمک می‌کند که تغییرات را بهتر درک کنید. اگر به هر دلیلی رنگ‌بندی غیرفعال شده باشد، می‌توانید آن را با این دستور دوباره فعال کنید:

```bash
git config --global color.ui auto
```

#### 4. **مقایسه با تاریخچه کامیت‌ها**

برای بررسی تغییرات یک فایل خاص در طول تاریخچه پروژه، می‌توانید از `git log -p <filename>` استفاده کنید که تفاوت‌های هر کامیت را برای آن فایل نمایش می‌دهد.

#### 5. **تغییر الگوریتم مقایسه**

اگر نیاز به مقایسه دقیق‌تری دارید، گیت به شما اجازه می‌دهد الگوریتم مقایسه‌ی خود را تغییر دهید. به عنوان مثال:

```bash
git diff --histogram
```

این دستور از الگوریتم `histogram` برای مقایسه تفاوت‌ها استفاده می‌کند که برای فایل‌هایی با تغییرات جزئی مفید است.

### نتیجه‌گیری

دستور `git diff` ابزاری بسیار مفید و قدرتمند برای بررسی و مدیریت تغییرات در فایل‌ها و پروژه‌های

گیت است. این دستور به شما اجازه می‌دهد که تغییرات ایجاد شده را قبل از کامیت، مقایسه تغییرات بین شاخه‌ها یا کامیت‌ها، و حتی مشاهده خلاصه تغییرات را بررسی کنید. با درک نحوه کار این دستور و استفاده صحیح از آن، می‌توانید تغییرات پروژه‌های خود را به طور موثری مدیریت و کنترل کنید.
