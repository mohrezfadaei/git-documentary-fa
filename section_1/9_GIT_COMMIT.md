## دستور `git commit`

دستور `git commit` یکی از مهم‌ترین و پرکاربردترین دستورات گیت (Git) است که به شما امکان می‌دهد تغییرات آماده‌شده (staged changes) را در مخزن گیت ثبت کنید. کامیت‌ها (commits) به عنوان نقاطی در تاریخچه پروژه عمل می‌کنند و به شما اجازه می‌دهند تا تغییرات خود را به‌طور دقیق ردیابی و مدیریت کنید. هر کامیت یک اسنپ‌شات از پروژه در لحظه‌ای خاص است و همراه با پیام توضیحی ثبت می‌شود.

### دستور `git commit` چه کاری انجام می‌دهد؟

زمانی که تغییراتی را در مخزن خود اعمال کرده‌اید و آن‌ها را با استفاده از دستور `git add` به مرحله آماده‌سازی (staging area) اضافه کرده‌اید، دستور `git commit` این تغییرات را در تاریخچه گیت ثبت می‌کند. هر کامیت شامل موارد زیر است:

1. **متادیتا (Metadata):** شامل نام و ایمیل نویسنده، زمان کامیت و شاخه فعلی.
2. **پیام کامیت:** یک توضیح کوتاه که تغییرات انجام‌شده را توضیح می‌دهد.
3. **شناسه‌ی کامیت (Commit ID):** هر کامیت یک هش SHA-1 یکتا دارد که به عنوان شناسه آن کامیت در تاریخچه عمل می‌کند.
4. **اشاره به کامیت قبلی:** کامیت‌ها به صورت زنجیره‌ای به یکدیگر متصل هستند و هر کامیت به کامیت قبلی اشاره می‌کند.

#### سینتکس:

```bash
git commit -m "پیام کامیت"
```

این دستور تغییرات آماده‌شده را ثبت می‌کند و پیام کامیتی که در کنار `-m` قرار گرفته است به عنوان توضیحی برای تغییرات ثبت می‌شود.

#### نمونه خروجی:

```plaintext
[main b3a1e2f] Added documentation
 3 files changed, 15 insertions(+), 3 deletions(-)
```

این خروجی نشان می‌دهد که کامیتی با شناسه‌ی `b3a1e2f` در شاخه `main` انجام شده است که شامل ۳ فایل تغییر یافته و تعدادی تغییرات (اضافه و حذف) است.

### گزینه‌های پرکاربرد با دستور `git commit`

#### 1. **استفاده از `-m` برای اضافه کردن پیام کامیت**

برای نوشتن پیام کامیت در همان دستور، از `-m` استفاده کنید:

```bash
git commit -m "توضیح تغییرات"
```

این روش متداول‌ترین روش برای نوشتن پیام کامیت است و معمولاً برای کامیت‌های کوچک و سریع استفاده می‌شود.

#### 2. **کامیت کردن همه فایل‌های تغییر یافته و آماده‌سازی نشده با `-a`**

با استفاده از گزینه `-a`، می‌توانید تمام فایل‌های تغییر یافته را بدون نیاز به `git add` به صورت خودکار به مرحله آماده‌سازی اضافه کنید و سپس آن‌ها را کامیت کنید:

```bash
git commit -a -m "پیام کامیت"
```

#### 3. **کامیت کردن بدون پیام با ویرایشگر پیش‌فرض**

اگر بخواهید پیام کامیت را در ویرایشگر متن بنویسید، می‌توانید دستور `git commit` را بدون گزینه `-m` اجرا کنید. این دستور ویرایشگر پیش‌فرض سیستم (مثل `vim` یا `nano`) را باز می‌کند تا پیام خود را وارد کنید:

```bash
git commit
```

#### 4. **اصلاح آخرین کامیت با `--amend`**

گاهی ممکن است پس از انجام کامیت، متوجه شوید که اشتباهی رخ داده یا تغییرات بیشتری باید انجام شود. با استفاده از `git commit --amend` می‌توانید کامیت قبلی را اصلاح کنید:

```bash
git commit --amend
```

این دستور کامیت جدید را با کامیت قبلی ترکیب می‌کند و به شما اجازه می‌دهد پیام یا تغییرات را اصلاح کنید.

#### 5. **انجام کامیت با تنظیم تاریخ خاص با `--date`**

در صورتی که بخواهید کامیتی را با تاریخ و زمان خاص انجام دهید، می‌توانید از گزینه `--date` استفاده کنید:

```bash
git commit --date="Wed Oct 27 12:00 2024 +0300" -m "پیام کامیت"
```

### چه اتفاقی در پس‌زمینه دستور `git commit` می‌افتد؟

1. **ایجاد یک اسنپ‌شات (Snapshot):**
   - زمانی که دستور `git commit` اجرا می‌شود، گیت یک اسنپ‌شات از فایل‌های آماده‌شده (staged files) در آن لحظه تهیه می‌کند. این اسنپ‌شات یک کپی از فایل‌ها نیست، بلکه تنها تغییرات انجام‌شده از آخرین کامیت تا کامیت فعلی ذخیره می‌شوند.
2. **ایجاد یک شناسه‌ی کامیت (Commit Hash):**

   - گیت برای هر کامیت یک شناسه‌ی یکتا (هش SHA-1) تولید می‌کند. این شناسه بر اساس محتوای کامیت، متادیتا و کامیت قبلی محاسبه می‌شود و به همین دلیل یکتا است. این شناسه به عنوان مرجعی برای شناسایی کامیت‌ها در تاریخچه عمل می‌کند.

3. **نوشتن متادیتا در تاریخچه:**

   - اطلاعاتی مانند نویسنده (author)، تاریخ و زمان کامیت، و پیام کامیت به همراه اسنپ‌شات فایل‌ها در تاریخچه مخزن گیت ثبت می‌شوند. گیت این اطلاعات را در پوشه‌ی `.git` ذخیره می‌کند.

4. **اشاره به کامیت قبلی:**

   - هر کامیت به کامیت قبلی خود در زنجیره‌ی تاریخچه اشاره می‌کند. این ساختار زنجیره‌ای (DAG - Directed Acyclic Graph) اجازه می‌دهد که گیت بتواند به‌طور مؤثر تاریخچه پروژه را بازسازی کند و به نسخه‌های قبلی برگردد.

5. **به‌روزرسانی شاخه فعلی:**
   - پس از انجام کامیت، شاخه فعلی (مانند `main`) به کامیت جدید اشاره می‌کند و شاخص شاخه (branch pointer) به‌روز می‌شود. این به معنای این است که شاخه شما اکنون شامل تغییرات جدید است.

### نکات و ترفندها

#### 1. **نوشتن پیام کامیت خوب**

پیام‌های کامیت باید کوتاه، شفاف و توضیح‌دهنده باشند. پیام‌های خوب به شما و دیگران کمک می‌کنند که تغییرات را در آینده بهتر درک کنید. یک ساختار پیشنهادی:

- **خط اول (خلاصه):** توضیح مختصر (حدود 50 کاراکتر) درباره‌ی تغییرات.
- **خط دوم (فاصله):** خط خالی برای جدا کردن خلاصه از توضیحات.
- **توضیحات بیشتر:** در صورت نیاز، توضیحاتی درباره تغییرات به همراه دلایل و زمینه بیشتر اضافه کنید.

مثال:

```plaintext
Add new function to handle I/O operations

This new function is designed to manage input/output operations and support parallel processing. It improves the efficiency and speed of I/O tasks.
```

#### 2. **همیشه وضعیت را قبل از کامیت بررسی کنید**

قبل از اجرای `git commit` بهتر است از دستور `git status` استفاده کنید تا مطمئن شوید فایل‌هایی که باید کامیت شوند به درستی به مرحله آماده‌سازی اضافه شده‌اند. این کار از اشتباهات معمول مانند جا گذاشتن فایل‌ها جلوگیری می‌کند.

#### 3. **استفاده از `git commit --amend` با احتیاط**

استفاده از `--amend` برای اصلاح کامیت‌ها مفید است، اما باید با احتیاط از آن استفاده کنید، به‌خصوص اگر کامیت قبلی را به اشتراک گذاشته باشید (مثلاً در مخزن راه دور با استفاده از `git push`). تغییر کامیت‌ها می‌تواند مشکلاتی در تاریخچه پروژه ایجاد کند.

#### 4. **تعامل با شاخه‌های مختلف**

وقتی روی شاخه‌های مختلف (مثل `feature` یا `bugfix`) کار می‌کنید، پیام‌های کامیت واضح و دقیق‌تر بنویسید تا درک تغییرات بین شاخه‌ها ساده‌تر شود. به خصوص زمانی که قرار است کامیت‌ها را با شاخه اصلی ادغام (merge) کنید.

#### 5. **کامیت کردن در فواصل منظم**

برای حفظ تاریخچه‌ی تمیز و شفاف، تغییرات خود را در فواصل منظم کامیت کنید. این کار به شما امکان می‌دهد تا به راحتی به نسخه‌های قبلی برگردید و اگر مشکلی پیش آمد، تاریخچه را بهتر مدیریت کنید.

### گزینه‌های پیشرفته با `git commit`

#### 1. **کامیت کردن تغییرات خاص با `-p`**

با استفاده از `git commit -p`، می‌توانید تکه‌های خاصی از تغییرات را به‌صورت دستی انتخاب کنید تا آن‌ها را کامیت کنید. این روش زمانی که نمی‌خواهید همه تغییرات را کامیت کنید، بسیار مفید است.

```bash
git commit -p
```

#### 2. **مشاهده تغییرات در حال کامیت با `--verbose`**

با استفاده از گزینه `--verbose`

، می‌توانید تغییرات فایل‌هایی که قرار است کامیت شوند را به همراه پیام کامیت مشاهده کنید:

```bash
git commit --verbose
```

#### 3. **استفاده از `--no-edit` برای حفظ پیام کامیت قبلی**

اگر از `git commit --amend` استفاده می‌کنید و نمی‌خواهید پیام کامیت قبلی را تغییر دهید، می‌توانید از گزینه `--no-edit` استفاده کنید:

```bash
git commit --amend --no-edit
```

#### 4. **استفاده از `--allow-empty` برای کامیت‌های خالی**

گاهی ممکن است بخواهید کامیتی بدون هیچ تغییری ایجاد کنید. با گزینه `--allow-empty` می‌توانید کامیت‌های خالی ایجاد کنید:

```bash
git commit --allow-empty -m "پیام کامیت"
```

### نتیجه‌گیری

دستور `git commit` قلب سیستم کنترل نسخه گیت است و به شما امکان می‌دهد تغییرات خود را به‌طور منظم ثبت و مدیریت کنید. پیام‌های کامیت واضح، بررسی دقیق تغییرات قبل از کامیت، و استفاده از امکانات پیشرفته این دستور، به شما کمک می‌کند که پروژه‌های خود را به بهترین شکل مدیریت کنید و تاریخچه‌ی تمیز و قابل‌فهمی از تغییرات داشته باشید. با درک بهتر از اینکه چه اتفاقی در پس‌زمینه دستور `git commit` می‌افتد، می‌توانید کامیت‌های خود را بهینه‌تر و مؤثرتر انجام دهید.
